generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String       @id @default(uuid())
  name         String
  email        String       @unique
  passwordHash String
  predictions  Prediction[] // 1-to-many
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

model Prediction {
  id           String           @id @default(uuid())
  imageUrl     String
  inferenceTime Float
  modelUsed    String
  rawResponse  Json
  userId       String
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  defects      DetectedDefect[] // 1-to-many
  createdAt    DateTime         @default(now())
}

model DetectedDefect {
  id           String   @id @default(uuid())
  predictionId String
  prediction   Prediction @relation(fields: [predictionId], references: [id], onDelete: Cascade)
  className    String
  confidence   Float
  x            Float
  y            Float
  width        Float
  height       Float
}
